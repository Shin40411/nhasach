import{dV as Se,dW as q,g as c,g2 as Ae,q as D,a$ as Re,j as e,b9 as F,I as h,N as B,bM as _,ei as M,W as E,B as u,bK as T,cv as O,T as R,ew as P,A as w,cq as ae,dQ as re,dP as De,Z as y,D as ie,ct as le,cu as L,eF as Ne,cn as Le,cB as Te,bC as $e,eg as Ue,c9 as ce,dT as Me,bG as de,g3 as Ee,g4 as se,fo as he,b8 as xe,dZ as K,b5 as ue,Y as Oe,dr as We,E as A,O as Q,aU as Y,cS as Fe,ex as Be,dv as Ge,eS as Ve,bD as ze,cy as He,aB as qe,eh as _e,x as H}from"./index-usks_mw-.js";import{u as Z,m as W}from"./index-BgJJ5cvl.js";import{k as Pe}from"./keyBy-Dc3MaNHd.js";import{E as ne}from"./empty-content-CMvi2U-9.js";import{A as pe}from"./AvatarGroup-DG664fc4.js";import{S as k}from"./Skeleton-T7cltK9a.js";import{C as Ke}from"./ClickAwayListener-C6V-kPZy.js";import{D as Qe}from"./DialogContent-hfRIofTz.js";import{S as $}from"./Stack-CgODRvvD.js";import{u as Ye,L as Ze}from"./use-light-box-Dg0bcRLG.js";import"./dialogTitleClasses-ArRuUPNv.js";const z=!1,N=Se.chat,J={revalidateIfStale:z,revalidateOnFocus:z,revalidateOnReconnect:z};function Je(){const s=[N,{params:{endpoint:"contacts"}}],{data:o,isLoading:r,error:i,isValidating:t}=Z(s,q,J);return c.useMemo(()=>({contacts:(o==null?void 0:o.contacts)||[],contactsLoading:r,contactsError:i,contactsValidating:t,contactsEmpty:!r&&!t&&!(o!=null&&o.contacts.length)}),[o==null?void 0:o.contacts,i,r,t])}function Xe(){const s=[N,{params:{endpoint:"conversations"}}],{data:o,isLoading:r,error:i,isValidating:t}=Z(s,q,J);return c.useMemo(()=>{const n=o!=null&&o.conversations.length?Pe(o.conversations,d=>d.id):{},l=Object.keys(n);return{conversations:{byId:n,allIds:l},conversationsLoading:r,conversationsError:i,conversationsValidating:t,conversationsEmpty:!r&&!t&&!l.length}},[o==null?void 0:o.conversations,i,r,t])}function es(s){const o=s?[N,{params:{conversationId:s,endpoint:"conversation"}}]:"",{data:r,isLoading:i,error:t,isValidating:a}=Z(o,q,J);return c.useMemo(()=>({conversation:r==null?void 0:r.conversation,conversationLoading:i,conversationError:t,conversationValidating:a,conversationEmpty:!i&&!a&&!(r!=null&&r.conversation)}),[r==null?void 0:r.conversation,t,i,a])}async function ss(s,o){const r=[N,{params:{endpoint:"conversations"}}];W([N,{params:{conversationId:s,endpoint:"conversation"}}],t=>{const a=t.conversation,n={...a,messages:[...a.messages,o]};return{...t,conversation:n}},!1),W(r,t=>{const n=t.conversations.map(l=>l.id===s?{...l,messages:[...l.messages,o]}:l);return{...t,conversations:n}},!1)}async function me(s){const o=[N,{params:{endpoint:"conversations"}}],r={conversationData:s},i=await Ae.post(N,r);return W(o,t=>{const n=[...t.conversations,s];return{...t,conversations:n}},!1),i.data}async function ns(s){W([N,{params:{endpoint:"conversations"}}],o=>{const i=o.conversations.map(t=>t.id===s?{...t,unreadCount:0}:t);return{...o,conversations:i}},!1)}const X=D(({selected:s,children:o,disabled:r,...i})=>e.jsxs(F,{disabled:r,...i,children:[o,e.jsx(h,{width:16,icon:(!s||r)&&"eva:arrow-ios-forward-fill"||"eva:arrow-ios-downward-fill"})]}))(({theme:s})=>({...s.typography.overline,height:40,paddingLeft:s.spacing(2.5),justifyContent:"space-between",paddingRight:s.spacing(1.5),color:s.vars.palette.text.secondary,backgroundColor:s.vars.palette.background.neutral})),os=D(Re)(({theme:s})=>({top:84,left:0,zIndex:9,width:32,height:32,position:"absolute",borderRadius:"0 12px 12px 0",boxShadow:s.vars.customShadows.primary,color:s.vars.palette.primary.contrastText,backgroundColor:s.vars.palette.primary.main,transition:s.transitions.create(["all"],{duration:s.transitions.duration.shorter}),"&:hover":{backgroundColor:s.vars.palette.primary.darker}}));function ts({currentUserId:s,conversation:o}){const{messages:r,participants:i}=o,t=i.filter(x=>x.id!==s),a=r[r.length-1],n=t.length>1,l=t.map(x=>x.name).join(", "),d=n?t.map(x=>x.status).includes("online"):!1;let m="";if(a){const x=a.senderId===s?"You: ":"",v=a.contentType==="image"?"Sent a photo":a.body;m=`${x}${v}`}return{group:n,displayName:l,displayText:m,participants:t,lastActivity:a.createdAt,hasOnlineInGroup:d}}function as({selected:s,collapse:o,conversation:r,onCloseMobile:i}){const{user:t}=M(),a=B(),n=_(I=>I.breakpoints.up("md")),{group:l,displayName:d,displayText:m,participants:x,lastActivity:v,hasOnlineInGroup:p}=ts({conversation:r,currentUserId:`${t==null?void 0:t.id}`}),g=x[0],j=c.useCallback(async()=>{try{n||i(),await ns(r.id);const I=`${E.dashboard.chat}?id=${r.id}`;c.startTransition(()=>{a.push(I)})}catch(I){console.error(I)}},[r.id,n,i,a]),b=()=>e.jsx(T,{variant:p?"online":"invisible",badgeContent:"",children:e.jsx(pe,{variant:"compact",sx:{width:48,height:48},children:x.slice(0,2).map(I=>e.jsx(w,{alt:I.name,src:I.avatarUrl},I.id))})}),C=()=>e.jsx(T,{variant:g==null?void 0:g.status,badgeContent:"",children:e.jsx(w,{alt:g==null?void 0:g.name,src:g==null?void 0:g.avatarUrl,sx:{width:48,height:48}})});return e.jsx(u,{component:"li",sx:{display:"flex"},children:e.jsxs(F,{onClick:j,sx:{py:1.5,px:2.5,gap:2,...s&&{bgcolor:"action.selected"}},children:[e.jsx(T,{color:"error",overlap:"circular",badgeContent:o?r.unreadCount:0,children:l?b():C()}),!o&&e.jsxs(e.Fragment,{children:[e.jsx(O,{primary:d,secondary:m,slotProps:{primary:{noWrap:!0},secondary:{noWrap:!0,sx:{...r.unreadCount&&{color:"text.primary",fontWeight:"fontWeightSemiBold"}}}}}),e.jsxs(u,{sx:{display:"flex",alignSelf:"stretch",alignItems:"flex-end",flexDirection:"column"},children:[e.jsx(R,{noWrap:!0,variant:"body2",component:"span",sx:{mb:1.5,fontSize:12,color:"text.disabled"},children:P(v)}),!!r.unreadCount&&e.jsx(u,{component:"span",sx:{width:8,height:8,borderRadius:"50%",bgcolor:"info.main"}})]})]})]})})}function rs(){var n;const{user:s}=M(),o=ae(),[r,i]=c.useState("online"),t=c.useCallback(l=>{i(l.target.value)},[]),a=()=>e.jsxs(re,{open:o.open,anchorEl:o.anchorEl,onClose:o.onClose,slotProps:{paper:{sx:{p:0,ml:0,mt:.5}},arrow:{placement:"top-left"}},children:[e.jsxs(u,{sx:{py:2,pr:1,pl:2,gap:2,display:"flex",alignItems:"center"},children:[e.jsx(O,{primary:s==null?void 0:s.displayName,secondary:s==null?void 0:s.email}),e.jsx(De,{title:"Log out",children:e.jsx(y,{color:"error",children:e.jsx(h,{icon:"ic:round-power-settings-new"})})})]}),e.jsx(ie,{sx:{borderStyle:"dashed"}}),e.jsxs(le,{sx:{my:.5,px:.5},children:[e.jsxs(L,{children:[e.jsx(T,{variant:r,badgeContent:"",sx:{width:24,height:24,alignItems:"center",justifyContent:"center",[`& .${Ne.badge}`]:{width:12,height:12,transform:"unset",position:"static"}}}),e.jsx(Le,{fullWidth:!0,children:e.jsx(Te,{native:!0,fullWidth:!0,value:r,onChange:t,input:e.jsx(ce,{}),inputProps:{id:"chat-status-select"},sx:{[`& .${Ue.root}`]:{right:0},[`& .${$e.input}`]:{typography:"body2",textTransform:"capitalize"}},children:["online","always","busy","offline"].map(l=>e.jsx("option",{value:l,children:l},l))})})]}),e.jsxs(L,{children:[e.jsx(h,{width:24,icon:"solar:user-id-bold"}),"Profile"]}),e.jsxs(L,{children:[e.jsx(h,{width:24,icon:"solar:settings-bold"}),"Settings"]})]})]});return e.jsxs(e.Fragment,{children:[e.jsx(T,{variant:r,badgeContent:"",overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(w,{src:s==null?void 0:s.photoURL,alt:s==null?void 0:s.displayName,onClick:o.onOpen,sx:{cursor:"pointer",width:48,height:48},children:(n=s==null?void 0:s.displayName)==null?void 0:n.charAt(0).toUpperCase()})}),a()]})}function is({sx:s,itemCount:o=6,...r}){return Array.from({length:o},(i,t)=>e.jsxs(u,{sx:[{gap:2,px:2.5,py:1.5,display:"flex",alignItems:"center"},...Array.isArray(s)?s:[s]],...r,children:[e.jsx(k,{variant:"circular",sx:{width:48,height:48}}),e.jsxs(u,{sx:{flex:"1 1 auto"},children:[e.jsx(k,{sx:{mb:1,width:.75,height:10}}),e.jsx(k,{sx:{width:.5,height:10}})]})]},t))}function ls({sx:s,...o}){return e.jsxs(u,{sx:[{width:1,display:"flex",alignItems:"center"},...Array.isArray(s)?s:[s]],...o,children:[e.jsx(k,{variant:"circular",sx:{width:40,height:40}}),e.jsxs(u,{sx:{mx:2,flex:"1 1 auto"},children:[e.jsx(k,{sx:{mb:1,width:96,height:10}}),e.jsx(k,{sx:{width:40,height:10}})]}),e.jsx(k,{variant:"circular",sx:{width:28,height:28}}),e.jsx(k,{variant:"circular",sx:{width:28,height:28,mx:1}}),e.jsx(k,{variant:"circular",sx:{width:28,height:28,mr:1}})]})}function cs({sx:s,...o}){return e.jsxs(u,{sx:[{pt:5,flexGrow:1,display:"flex",alignItems:"center",flexDirection:"column"},...Array.isArray(s)?s:[s]],...o,children:[e.jsx(k,{variant:"circular",sx:{width:96,height:96}}),e.jsx(k,{sx:{mb:1,mt:2,height:10,width:.65}}),e.jsx(k,{sx:{mb:5,width:.35,height:10}}),e.jsx(Me,{color:"inherit",thickness:2})]})}function ds({query:s,results:o,onClickResult:r}){const i=o.length,t=!i&&!!s,a=()=>e.jsx(de,{query:s,sx:{p:3,mx:"auto",width:"calc(100% - 40px)",bgcolor:"background.neutral"}}),n=()=>e.jsx("nav",{children:e.jsx(u,{component:"ul",sx:{"& li":{display:"flex"}},children:o.map(l=>e.jsx("li",{children:e.jsxs(F,{onClick:()=>r(l),sx:{gap:2,py:1.5,px:2.5,typography:"subtitle2"},children:[e.jsx(w,{alt:l.name,src:l.avatarUrl}),l.name]})},l.id))})});return e.jsxs(e.Fragment,{children:[e.jsxs(R,{variant:"h6",sx:{px:2.5,mb:2},children:["Contacts (",i,")"]}),t?a():n()]})}function ge({message:s="",recipients:o,me:r}){var n;const i=o.length>1,t={id:se(),attachments:[],body:s,contentType:"text",createdAt:Ee({minutes:1}),senderId:r.id},a={id:i?se():(n=o[0])==null?void 0:n.id,messages:[t],participants:[...o,r],type:i?"GROUP":"ONE_TO_ONE",unreadCount:0};return{messageData:t,conversationData:a}}const oe=320,hs=96;function xs({loading:s,contacts:o,collapseNav:r,conversations:i,selectedConversationId:t}){const a=B(),{user:n}=M(),l=_(f=>f.breakpoints.up("md")),{openMobile:d,onOpenMobile:m,onCloseMobile:x,onCloseDesktop:v,collapseDesktop:p,onCollapseDesktop:g}=r,[j,b]=c.useState({query:"",results:[]}),C=c.useMemo(()=>({id:`${n==null?void 0:n.id}`,role:`${n==null?void 0:n.role}`,email:`${n==null?void 0:n.email}`,address:`${n==null?void 0:n.address}`,name:`${n==null?void 0:n.displayName}`,lastActivity:he(),avatarUrl:`${n==null?void 0:n.photoURL}`,phoneNumber:`${n==null?void 0:n.phoneNumber}`,status:"online"}),[n]);c.useEffect(()=>{l||v()},[v,l]);const I=c.useCallback(()=>{l?g():x()},[l,x,g]),je=c.useCallback(()=>{l||x(),a.push(E.dashboard.chat)},[l,x,a]),fe=c.useCallback(f=>{if(b(U=>({...U,query:f})),f){const U=o.filter(S=>S.name.toLowerCase().includes(f.toLowerCase()));b(S=>({...S,results:U}))}},[o]),G=c.useCallback(()=>{b({query:"",results:[]})},[]),ye=c.useCallback(async f=>{G();const U=S=>a.push(`${E.dashboard.chat}?id=${S}`);try{if(i.allIds.includes(f.id)){U(f.id);return}const S=o.find(Ie=>Ie.id===f.id);if(!S){console.error("Recipient not found");return}const{conversationData:we}=ge({recipients:[S],me:C}),V=await me(we);(!V||!V.conversation)&&console.error("Failed to create conversation"),U(V.conversation.id)}catch(S){console.error("Error handling click result:",S)}},[o,i.allIds,G,C,a]),ve=()=>e.jsx(is,{}),be=()=>e.jsx("nav",{children:e.jsx(u,{component:"ul",children:i.allIds.map(f=>e.jsx(as,{collapse:p,conversation:i.byId[f],selected:f===t,onCloseMobile:x},f))})}),Ce=()=>e.jsx(ds,{query:j.query,results:j.results,onClickResult:ye}),ke=()=>e.jsx(Ke,{onClickAway:G,children:e.jsx(ue,{fullWidth:!0,value:j.query,onChange:f=>fe(f.target.value),placeholder:"Search contacts...",slotProps:{input:{startAdornment:e.jsx(Oe,{position:"start",children:e.jsx(h,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}},sx:{mt:2.5}})}),ee=()=>e.jsxs(e.Fragment,{children:[e.jsxs(u,{sx:{pt:2.5,px:2.5,display:"flex",alignItems:"center",justifyContent:"center"},children:[!p&&e.jsxs(e.Fragment,{children:[e.jsx(rs,{}),e.jsx(u,{sx:{flexGrow:1}})]}),e.jsx(y,{onClick:I,children:e.jsx(h,{icon:p?"eva:arrow-ios-forward-fill":"eva:arrow-ios-back-fill"})}),!p&&e.jsx(y,{onClick:je,children:e.jsx(h,{width:24,icon:"solar:user-plus-bold"})})]}),e.jsx(u,{sx:{p:2.5,pt:0},children:!p&&ke()}),s?ve():e.jsx(K,{sx:{pb:1},children:j.query&&i.allIds.length?Ce():be()})]});return e.jsxs(e.Fragment,{children:[e.jsx(os,{onClick:m,sx:{display:{md:"none"}},children:e.jsx(h,{width:16,icon:"solar:users-group-rounded-bold"})}),e.jsx(u,{sx:[f=>({minHeight:0,flex:"1 1 auto",width:oe,flexDirection:"column",display:{xs:"none",md:"flex"},borderRight:`solid 1px ${f.vars.palette.divider}`,transition:f.transitions.create(["width"],{duration:f.transitions.duration.shorter}),...p&&{width:hs}})],children:ee()}),e.jsx(xe,{open:d,onClose:x,slotProps:{backdrop:{invisible:!0},paper:{sx:{width:oe}}},children:ee()})]})}function us({slots:s,sx:o,...r}){return e.jsxs(ps,{sx:o,...r,children:[e.jsx(gs,{children:s.nav}),e.jsxs(js,{children:[e.jsx(ms,{children:s.header}),e.jsxs(fs,{children:[e.jsx(ys,{children:s.main}),e.jsx(vs,{children:s.details})]})]})]})}const ps=D("div")(({theme:s})=>({minHeight:0,flex:"1 1 0",display:"flex",position:"relative",boxShadow:s.vars.customShadows.card,borderRadius:s.shape.borderRadius*2,backgroundColor:s.vars.palette.background.paper})),ms=D("div")(({theme:s})=>({height:72,flexShrink:0,display:"flex",alignItems:"center",padding:s.spacing(1,1,1,2.5),borderBottom:`solid 1px ${s.vars.palette.divider}`})),gs=D("div")(()=>({display:"flex",flexDirection:"column"})),js=D("div")(()=>({minWidth:0,display:"flex",flex:"1 1 auto",flexDirection:"column"})),fs=D("div")(()=>({minHeight:0,display:"flex",flex:"1 1 auto"})),ys=D("div")(()=>({minWidth:0,display:"flex",flex:"1 1 auto",flexDirection:"column"})),vs=D("div")(()=>({minHeight:0,display:"flex",flexDirection:"column"}));function bs({participant:s,open:o,onClose:r}){return e.jsxs(We,{fullWidth:!0,maxWidth:"xs",open:o,onClose:r,children:[e.jsx(y,{onClick:r,sx:{position:"absolute",right:8,top:8},children:e.jsx(h,{icon:"mingcute:close-line"})}),e.jsxs(Qe,{sx:{py:5,px:3,display:"flex"},children:[e.jsx(w,{alt:s.name,src:s.avatarUrl,sx:{width:96,height:96,mr:3}}),e.jsxs($,{spacing:1,children:[e.jsx(R,{variant:"caption",sx:{color:"primary.main"},children:s.role}),e.jsx(R,{variant:"subtitle1",children:s.name}),e.jsxs(u,{sx:{display:"flex",typography:"caption",color:"text.disabled"},children:[e.jsx(h,{icon:"mingcute:location-fill",width:16,sx:{flexShrink:0,mr:.5,mt:"2px"}}),s.address]}),e.jsxs(u,{sx:{gap:1,pt:1.5,display:"flex"},children:[e.jsx(y,{size:"small",color:"error",sx:[i=>({borderRadius:1,bgcolor:A(i.vars.palette.error.mainChannel,.08),"&:hover":{bgcolor:A(i.vars.palette.error.mainChannel,.16)}})],children:e.jsx(h,{width:18,icon:"solar:phone-bold"})}),e.jsx(y,{size:"small",color:"info",sx:[i=>({borderRadius:1,bgcolor:A(i.vars.palette.info.mainChannel,.08),"&:hover":{bgcolor:A(i.vars.palette.info.mainChannel,.16)}})],children:e.jsx(h,{width:18,icon:"solar:chat-round-dots-bold"})}),e.jsx(y,{size:"small",color:"primary",sx:[i=>({borderRadius:1,bgcolor:A(i.vars.palette.primary.mainChannel,.08),"&:hover":{bgcolor:A(i.vars.palette.primary.mainChannel,.16)}})],children:e.jsx(h,{width:18,icon:"solar:letter-bold"})}),e.jsx(y,{size:"small",color:"secondary",sx:[i=>({borderRadius:1,bgcolor:A(i.vars.palette.secondary.mainChannel,.08),"&:hover":{bgcolor:A(i.vars.palette.secondary.mainChannel,.16)}})],children:e.jsx(h,{width:18,icon:"solar:videocamera-record-bold"})})]})]})]})]})}function Cs({participants:s}){const o=Q(!0),[r,i]=c.useState(null),t=c.useCallback(d=>{i(d)},[]),a=c.useCallback(()=>{i(null)},[]),n=s.length,l=()=>e.jsx(e.Fragment,{children:s.map(d=>e.jsxs(F,{onClick:()=>t(d),children:[e.jsx(T,{variant:d.status,badgeContent:"",children:e.jsx(w,{alt:d.name,src:d.avatarUrl})}),e.jsx(O,{primary:d.name,secondary:d.role,slotProps:{primary:{noWrap:!0},secondary:{noWrap:!0,sx:{typography:"caption"}}},sx:{ml:2}})]},d.id))});return e.jsxs(e.Fragment,{children:[e.jsx(X,{selected:o.value,disabled:!n,onClick:o.onToggle,children:`In room (${n})`}),e.jsx(Y,{in:o.value,children:l()}),r&&e.jsx(bs,{participant:r,open:!!r,onClose:a})]})}function ks({participant:s}){const o=Q(!0),r=[{icon:"mingcute:location-fill",value:s==null?void 0:s.address},{icon:"solar:phone-bold",value:s==null?void 0:s.phoneNumber},{icon:"solar:letter-bold",value:s==null?void 0:s.email}],i=()=>e.jsxs($,{alignItems:"center",sx:{py:5},children:[e.jsx(w,{alt:s==null?void 0:s.name,src:s==null?void 0:s.avatarUrl,sx:{width:96,height:96,mb:2}}),e.jsx(R,{variant:"subtitle1",children:s==null?void 0:s.name}),e.jsx(R,{variant:"body2",sx:{color:"text.secondary",mt:.5},children:s==null?void 0:s.role})]}),t=()=>e.jsx($,{spacing:2,sx:{px:2,py:2.5},children:r.map(a=>e.jsxs(u,{sx:{gap:1,display:"flex",typography:"body2",wordBreak:"break-all"},children:[e.jsx(h,{icon:a.icon,sx:{flexShrink:0,color:"text.disabled"}}),a.value]},a.icon))});return e.jsxs(e.Fragment,{children:[i(),e.jsx(X,{selected:o.value,onClick:o.onToggle,children:"Information"}),e.jsx(Y,{in:o.value,children:t()})]})}function ws({attachments:s}){const o=Q(!0),r=s.length,i=()=>s.map((t,a)=>e.jsxs(u,{sx:{gap:1.5,display:"flex",alignItems:"center"},children:[e.jsx(Fe,{imageView:!0,file:t.preview,onDownload:()=>console.info("DOWNLOAD"),slotProps:{icon:{sx:{width:24,height:24}}},sx:{width:40,height:40,bgcolor:"background.neutral"}}),e.jsx(O,{primary:t.name,secondary:Be(t.createdAt),slotProps:{primary:{noWrap:!0,sx:{typography:"body2"}},secondary:{noWrap:!0,sx:{mt:.25,typography:"caption",color:"text.disabled"}}}})]},t.name+a));return e.jsxs(e.Fragment,{children:[e.jsx(X,{selected:o.value,disabled:!r,onClick:o.onToggle,children:`Attachments (${r})`}),!!r&&e.jsx(Y,{in:o.value,children:e.jsx($,{spacing:2,sx:{p:2},children:i()})})]})}const Is=280,Ss=320;function As({collapseNav:s,participants:o,messages:r,loading:i,sx:t,...a}){const{collapseDesktop:n,openMobile:l,onCloseMobile:d}=s,m=o.length>1,x=r.map(p=>p.attachments).flat(1)||[],v=()=>i?e.jsx(cs,{}):e.jsx(K,{children:e.jsxs("div",{children:[m?e.jsx(Cs,{participants:o}):e.jsx(ks,{participant:o[0]}),e.jsx(ws,{attachments:x})]})});return e.jsxs(e.Fragment,{children:[e.jsx(u,{sx:[p=>({minHeight:0,flex:"1 1 auto",width:Is,flexDirection:"column",display:{xs:"none",lg:"flex"},borderLeft:`solid 1px ${p.vars.palette.divider}`,transition:p.transitions.create(["width"],{duration:p.transitions.duration.shorter}),...n&&{width:0}}),...Array.isArray(t)?t:[t]],...a,children:!n&&v()}),e.jsx(xe,{anchor:"right",open:l,onClose:d,slotProps:{backdrop:{invisible:!0},paper:{sx:{width:Ss}}},children:v()})]})}function Rs({message:s,participants:o,currentUserId:r}){var l;const i=o.find(d=>d.id===s.senderId),t=s.senderId===r,a=t?{type:"me"}:{avatarUrl:i==null?void 0:i.avatarUrl,firstName:((l=i==null?void 0:i.name)==null?void 0:l.split(" ")[0])??"Unknown"};return{hasImage:s.contentType==="image",me:t,senderDetails:a}}function Ds({message:s,participants:o,onOpenLightbox:r}){const{user:i}=M(),{me:t,senderDetails:a,hasImage:n}=Rs({message:s,participants:o,currentUserId:`${i==null?void 0:i.id}`}),{firstName:l,avatarUrl:d}=a,{body:m,createdAt:x}=s,v=()=>e.jsxs(R,{noWrap:!0,variant:"caption",sx:{mb:1,color:"text.disabled",...!t&&{mr:"auto"}},children:[!t&&`${l}, `,P(x)]}),p=()=>e.jsx($,{sx:{p:1.5,minWidth:48,maxWidth:320,borderRadius:1,typography:"body2",bgcolor:"background.neutral",...t&&{color:"grey.800",bgcolor:"primary.lighter"},...n&&{p:0,bgcolor:"transparent"}},children:n?e.jsx(u,{component:"img",alt:"Attachment",src:m,onClick:()=>r(m),sx:{width:400,height:"auto",borderRadius:1.5,cursor:"pointer",objectFit:"cover",aspectRatio:"16/11","&:hover":{opacity:.9}}}):m}),g=()=>e.jsxs(u,{className:"message-actions",sx:j=>({pt:.5,left:0,opacity:0,top:"100%",display:"flex",position:"absolute",transition:j.transitions.create(["opacity"],{duration:j.transitions.duration.shorter}),...t&&{right:0,left:"unset"}}),children:[e.jsx(y,{size:"small",children:e.jsx(h,{icon:"solar:reply-bold",width:16})}),e.jsx(y,{size:"small",children:e.jsx(h,{icon:"eva:smiling-face-fill",width:16})}),e.jsx(y,{size:"small",children:e.jsx(h,{icon:"solar:trash-bin-trash-bold",width:16})})]});return s.body?e.jsxs(u,{sx:{mb:5,display:"flex",justifyContent:t?"flex-end":"unset"},children:[!t&&e.jsx(w,{alt:l,src:d,sx:{width:32,height:32,mr:2}}),e.jsxs($,{alignItems:t?"flex-end":"flex-start",children:[v(),e.jsxs(u,{sx:{display:"flex",alignItems:"center",position:"relative","&:hover":{"& .message-actions":{opacity:1}}},children:[p(),g()]})]})]}):null}function Ns(s){const o=c.useRef(null),r=c.useCallback(()=>{s&&o.current&&o.current&&(o.current.scrollTop=o.current.scrollHeight)},[s]);return c.useEffect(()=>{r()},[s]),{messagesEndRef:o}}function Ls({messages:s=[],participants:o,loading:r}){const{messagesEndRef:i}=Ns(s),t=s.filter(n=>n.contentType==="image").map(n=>({src:n.body})),a=Ye(t);return r?e.jsx($,{sx:{flex:"1 1 auto",position:"relative"},children:e.jsx(Ge,{color:"inherit",sx:{top:0,left:0,width:1,height:2,borderRadius:0,position:"absolute"}})}):e.jsxs(e.Fragment,{children:[e.jsx(K,{ref:i,sx:{px:3,pt:5,pb:3,flex:"1 1 auto"},children:s.map(n=>e.jsx(Ds,{message:n,participants:o,onOpenLightbox:()=>a.onOpen(n.body)},n.id))}),e.jsx(Ze,{slides:t,open:a.open,close:a.onClose,index:a.selected})]})}function Ts({disabled:s,recipients:o,onAddRecipients:r,selectedConversationId:i}){const t=B(),{user:a}=M(),n=c.useRef(null),[l,d]=c.useState(""),m=c.useMemo(()=>({id:`${a==null?void 0:a.id}`,role:`${a==null?void 0:a.role}`,email:`${a==null?void 0:a.email}`,address:`${a==null?void 0:a.address}`,name:`${a==null?void 0:a.displayName}`,lastActivity:he(),avatarUrl:`${a==null?void 0:a.photoURL}`,phoneNumber:`${a==null?void 0:a.phoneNumber}`,status:"online"}),[a]),{messageData:x,conversationData:v}=ge({message:l,recipients:o,me:m}),p=c.useCallback(()=>{n.current&&n.current.click()},[]),g=c.useCallback(b=>{d(b.target.value)},[]),j=c.useCallback(async b=>{if(!(b.key!=="Enter"||!l))try{if(i)await ss(i,x);else{const C=await me(v);t.push(`${E.dashboard.chat}?id=${C.conversation.id}`),r([])}}catch(C){console.error(C)}finally{d("")}},[v,l,x,r,t,i]);return e.jsxs(e.Fragment,{children:[e.jsx(ce,{name:"chat-message",id:"chat-message-input",value:l,onKeyUp:j,onChange:g,placeholder:"Type a message",disabled:s,startAdornment:e.jsx(y,{children:e.jsx(h,{icon:"eva:smiling-face-fill"})}),endAdornment:e.jsxs(u,{sx:{flexShrink:0,display:"flex"},children:[e.jsx(y,{onClick:p,children:e.jsx(h,{icon:"solar:gallery-add-bold"})}),e.jsx(y,{onClick:p,children:e.jsx(h,{icon:"eva:attach-2-fill"})}),e.jsx(y,{children:e.jsx(h,{icon:"solar:microphone-bold"})})]}),sx:[b=>({px:1,height:56,flexShrink:0,borderTop:`solid 1px ${b.vars.palette.divider}`})]}),e.jsx("input",{type:"file",ref:n,style:{display:"none"}})]})}function $s({collapseNav:s,participants:o,loading:r}){const i=_(j=>j.breakpoints.up("lg")),t=ae(),a=o.length>1,n=o[0],{collapseDesktop:l,onCollapseDesktop:d,onOpenMobile:m}=s,x=c.useCallback(()=>{i?d():m()},[i]),v=()=>e.jsx(pe,{max:3,sx:{[`& .${Ve.avatar}`]:{width:32,height:32}},children:o.map(j=>e.jsx(w,{alt:j.name,src:j.avatarUrl},j.id))}),p=()=>e.jsxs(u,{sx:{gap:2,display:"flex",alignItems:"center"},children:[e.jsx(T,{variant:n==null?void 0:n.status,badgeContent:"",children:e.jsx(w,{src:n==null?void 0:n.avatarUrl,alt:n==null?void 0:n.name})}),e.jsx(O,{primary:n==null?void 0:n.name,secondary:(n==null?void 0:n.status)==="offline"?P(n==null?void 0:n.lastActivity):n==null?void 0:n.status})]});if(r)return e.jsx(ls,{});const g=()=>e.jsx(re,{open:t.open,anchorEl:t.anchorEl,onClose:t.onClose,children:e.jsxs(le,{children:[e.jsxs(L,{onClick:()=>t.onClose(),children:[e.jsx(h,{icon:"solar:bell-off-bold"}),"Hide notifications"]}),e.jsxs(L,{onClick:()=>t.onClose(),children:[e.jsx(h,{icon:"solar:forbidden-circle-bold"}),"Block"]}),e.jsxs(L,{onClick:()=>t.onClose(),children:[e.jsx(h,{icon:"solar:danger-triangle-bold"}),"Report"]}),e.jsx(ie,{sx:{borderStyle:"dashed"}}),e.jsxs(L,{onClick:()=>t.onClose(),sx:{color:"error.main"},children:[e.jsx(h,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})]})});return e.jsxs(e.Fragment,{children:[a?v():p(),e.jsxs(u,{sx:{flexGrow:1,display:"flex",justifyContent:"flex-end"},children:[e.jsx(y,{children:e.jsx(h,{icon:"solar:phone-bold"})}),e.jsx(y,{children:e.jsx(h,{icon:"solar:videocamera-record-bold"})}),e.jsx(y,{onClick:x,children:e.jsx(h,{icon:l?"custom:sidebar-fold-fill":"custom:sidebar-unfold-fill"})}),e.jsx(y,{onClick:t.onOpen,children:e.jsx(h,{icon:"eva:more-vertical-fill"})})]}),g()]})}function Us({contacts:s,onAddRecipients:o}){const[r,i]=c.useState(""),t=c.useCallback(a=>{i(""),o(a)},[o]);return e.jsxs(e.Fragment,{children:[e.jsx(R,{variant:"subtitle2",sx:{color:"text.primary",mr:2},children:"To:"}),e.jsx(ze,{sx:{minWidth:{md:320},flexGrow:{xs:1,md:"unset"}},multiple:!0,limitTags:3,popupIcon:null,defaultValue:[],disableCloseOnSelect:!0,noOptionsText:e.jsx(de,{query:r}),onChange:(a,n)=>t(n),onInputChange:(a,n)=>i(n),options:s,getOptionLabel:a=>a.name,isOptionEqualToValue:(a,n)=>a.id===n.id,renderInput:a=>e.jsx(ue,{...a,placeholder:"+ Recipients"}),renderOption:(a,n,{selected:l})=>c.createElement("li",{...a,key:n.id},e.jsxs(u,{sx:{mr:1,width:32,height:32,overflow:"hidden",borderRadius:"50%",position:"relative"},children:[e.jsx(w,{alt:n.name,src:n.avatarUrl,sx:{width:1,height:1}}),e.jsx(u,{sx:[d=>({top:0,left:0,width:1,height:1,opacity:0,display:"flex",position:"absolute",alignItems:"center",justifyContent:"center",bgcolor:A(d.vars.palette.grey["900Channel"],.8),transition:d.transitions.create(["opacity"],{easing:d.transitions.easing.easeInOut,duration:d.transitions.duration.shorter}),...l&&{opacity:1,color:"primary.main"}})],children:e.jsx(h,{icon:"eva:checkmark-fill"})})]},n.id),n.name),renderTags:(a,n)=>a.map((l,d)=>c.createElement(He,{...n({index:d}),key:l.id,label:l.name,avatar:e.jsx(w,{alt:l.name,src:l.avatarUrl}),size:"small",variant:"soft"}))})]})}function te(){const[s,o]=c.useState(!1),[r,i]=c.useState(!1),t=c.useCallback(()=>{i(d=>!d)},[]),a=c.useCallback(()=>{i(!1)},[]),n=c.useCallback(()=>{o(!0)},[]),l=c.useCallback(()=>{o(!1)},[]);return{collapseDesktop:r,onCloseDesktop:a,onCollapseDesktop:t,openMobile:s,onOpenMobile:n,onCloseMobile:l}}function Ms(){const s=B(),{user:o}=M(),{contacts:r}=Je(),t=qe().get("id")||"",{conversations:a,conversationsLoading:n}=Xe(),{conversation:l,conversationError:d,conversationLoading:m}=es(t),x=te(),v=te(),[p,g]=c.useState([]);c.useEffect(()=>{t||c.startTransition(()=>{s.push(E.dashboard.chat)})},[d,s,t]);const j=c.useCallback(C=>{g(C)},[]),b=l?l.participants.filter(C=>C.id!==`${o==null?void 0:o.id}`):[];return e.jsxs(_e,{maxWidth:!1,sx:{display:"flex",flex:"1 1 auto",flexDirection:"column"},children:[e.jsx(R,{variant:"h4",sx:{mb:{xs:3,md:5}},children:"Chat"}),e.jsx(us,{slots:{header:t?e.jsx($s,{collapseNav:x,participants:b,loading:m}):e.jsx(Us,{contacts:r,onAddRecipients:j}),nav:e.jsx(xs,{contacts:r,conversations:a,selectedConversationId:t,collapseNav:v,loading:n}),main:e.jsxs(e.Fragment,{children:[t?d?e.jsx(ne,{title:d.message,imgUrl:`${H.assetsDir}/assets/icons/empty/ic-chat-empty.svg`}):e.jsx(Ls,{messages:(l==null?void 0:l.messages)??[],participants:b,loading:m}):e.jsx(ne,{title:"Good morning!",description:"Write something awesome...",imgUrl:`${H.assetsDir}/assets/icons/empty/ic-chat-active.svg`}),e.jsx(Ts,{recipients:p,onAddRecipients:j,selectedConversationId:t,disabled:!p.length&&!t})]}),details:l&&t&&e.jsx(As,{collapseNav:x,participants:b,loading:m,messages:(l==null?void 0:l.messages)??[]})}})]})}const Es={title:`Chat | Dashboard - ${H.appName}`};function Ks(){return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:Es.title}),e.jsx(Ms,{})]})}export{Ks as default};
