import{dV as W,dW as B,g as u,j as e,B as a,b5 as K,I as c,E as N,b4 as Z,F as R,dZ as V,o as D,l as S,A as q,cv as ne,T as y,ew as oe,bM as U,b1 as J,U as P,V as x,K as k,d1 as re,d2 as te,aT as ae,c9 as _,g5 as ie,b6 as le,cg as ce,e9 as de,e8 as xe,dP as $,ex as pe,N as he,aX as Q,aQ as ue,cS as fe,H as je,ax as me,O as T,eh as ge}from"./index-BPi-lj99.js";import{u as O}from"./index-Wm6Wo2AT.js";import{k as be}from"./keyBy-Dc3MaNHd.js";import{E as G}from"./empty-content-9ilj_6E5.js";import{S as I}from"./Skeleton-CCIywKNc.js";import{S as m}from"./Stack-qxGgU9sa.js";import{E as Y}from"./editor-BHaBjMrK.js";import{M as ye}from"./markdown-BKz7NLwC.js";import{C as X}from"./Checkbox-Cb0hcSDN.js";import"./code-highlight-block-CqLMdGe8.js";import"./html-to-markdown-BekkAF-z.js";import"./image-31DAP9Wr.js";const H={revalidateIfStale:!1,revalidateOnFocus:!1,revalidateOnReconnect:!1};function ve(){const s=W.mail.labels,{data:o,isLoading:n,error:r,isValidating:t}=O(s,B,H);return u.useMemo(()=>({labels:(o==null?void 0:o.labels)||[],labelsLoading:n,labelsError:r,labelsValidating:t,labelsEmpty:!n&&!t&&!(o!=null&&o.labels.length)}),[o==null?void 0:o.labels,r,n,t])}function we(s){const o=s?[W.mail.list,{params:{labelId:s}}]:"",{data:n,isLoading:r,error:t,isValidating:l}=O(o,B,H);return u.useMemo(()=>{const p=n!=null&&n.mails.length?be(n==null?void 0:n.mails,g=>g.id):{},f=Object.keys(p);return{mails:{byId:p,allIds:f},mailsLoading:r,mailsError:t,mailsValidating:l,mailsEmpty:!r&&!l&&!f.length}},[n==null?void 0:n.mails,t,r,l])}function ke(s){const o=s?[W.mail.details,{params:{mailId:s}}]:"",{data:n,isLoading:r,error:t,isValidating:l}=O(o,B,H);return u.useMemo(()=>({mail:n==null?void 0:n.mail,mailLoading:r,mailError:t,mailValidating:l,mailEmpty:!r&&!l&&!(n!=null&&n.mail)}),[n==null?void 0:n.mail,t,r,l])}const Ce={all:"solar:letter-bold",inbox:"solar:inbox-bold",trash:"solar:trash-bin-trash-bold",drafts:"solar:file-text-bold",spam:"solar:danger-bold",sent:"custom:send-fill",starred:"eva:star-fill",important:"ic:round-label-important",social:"solar:tag-horizontal-bold-duotone",promotions:"solar:tag-horizontal-bold-duotone",forums:"solar:tag-horizontal-bold-duotone"};function Ie({selected:s,label:o,onClickNavItem:n,...r}){const t=Ce[o.id];return e.jsx(a,{component:"li",sx:{display:"flex"},children:e.jsxs(K,{disableGutters:!0,onClick:n,sx:{pl:1,pr:1.5,gap:2,borderRadius:.75,color:"text.secondary",...s&&{color:"text.primary"}},...r,children:[e.jsx(c,{icon:t,width:22,sx:{color:o.color}}),e.jsx(a,{component:"span",sx:{flexGrow:1,textTransform:"capitalize",typography:s?"subtitle2":"body2"},children:o.name}),!!o.unreadCount&&e.jsx(a,{component:"span",sx:{typography:"caption"},children:o.unreadCount})]})})}function Se({itemCount:s=6,sx:o,...n}){return Array.from({length:s},(r,t)=>e.jsxs(a,{sx:[l=>({py:1,gap:2,display:"flex",alignItems:"center",color:N(l.vars.palette.grey["500Channel"],.24)}),...Array.isArray(o)?o:[o]],...n,children:[e.jsx(I,{variant:"circular",sx:{width:32,height:32,bgcolor:"currentColor"}}),e.jsx(I,{sx:{width:.5,height:10,bgcolor:"currentColor"}})]},t))}function Le({sx:s,itemCount:o=6,...n}){return Array.from({length:o},(r,t)=>e.jsxs(a,{sx:[{py:1,gap:2,display:"flex",alignItems:"center"},...Array.isArray(s)?s:[s]],...n,children:[e.jsx(I,{variant:"circular",sx:{width:40,height:40}}),e.jsxs(a,{sx:{flex:"1 1 auto"},children:[e.jsx(I,{sx:{mb:1,width:.75,height:10}}),e.jsx(I,{sx:{width:.5,height:10}})]})]},t))}function Me({isEmpty:s,loading:o,labels:n,openNav:r,onCloseNav:t,onClickLabel:l,selectedLabelId:i,onToggleCompose:p}){const f=()=>e.jsx(m,{sx:{flex:"1 1 auto",px:{xs:2.5,md:1.5}},children:e.jsx(Se,{})}),g=()=>e.jsx(m,{sx:{flex:"1 1 auto",px:{xs:2.5,md:1.5}},children:e.jsx(G,{title:"No labels",imgUrl:`${D.assetsDir}/assets/icons/empty/ic-folder-empty.svg`})}),w=()=>s?g():e.jsx(V,{sx:{flex:"1 1 0"},children:e.jsx("nav",{children:e.jsx(a,{component:"ul",sx:{pb:1.5,px:{xs:1.5,md:.5}},children:n.map(h=>e.jsx(Ie,{label:h,selected:i===h.id,onClickNavItem:()=>l(h.id)},h.id))})})}),v=()=>e.jsxs(e.Fragment,{children:[e.jsx(a,{sx:h=>({p:{xs:2.5,md:h.spacing(2,1.5)}}),children:e.jsx(R,{fullWidth:!0,color:"inherit",variant:"contained",startIcon:e.jsx(c,{icon:"solar:pen-bold"}),onClick:p,children:"Compose"})}),o?f():w()]});return e.jsxs(e.Fragment,{children:[v(),e.jsx(Z,{open:r,onClose:t,slotProps:{backdrop:{invisible:!0},paper:{sx:{width:280}}},children:v()})]})}function Te({slots:s,slotProps:o,sx:n,...r}){return e.jsxs(Ae,{sx:n,...r,children:[s.header,e.jsxs(De,{...o==null?void 0:o.container,children:[e.jsx(Ee,{...o==null?void 0:o.nav,children:s.nav}),e.jsx(Fe,{...o==null?void 0:o.list,children:s.list}),e.jsx($e,{...o==null?void 0:o.details,children:s.details})]})]})}const Ae=S("div")(()=>({display:"flex",flexDirection:"column"})),De=S("div")(({theme:s})=>({gap:s.spacing(1),display:"flex",flex:"1 1 auto",overflow:"hidden"})),Ee=S("div")(({theme:s})=>({display:"none",flex:"0 0 200px",overflow:"hidden",flexDirection:"column",[s.breakpoints.up("md")]:{display:"flex"}})),Fe=S("div")(({theme:s})=>({display:"none",flex:"0 0 320px",overflow:"hidden",flexDirection:"column",borderRadius:s.shape.borderRadius*1.5,backgroundColor:s.vars.palette.background.default,[s.breakpoints.up("md")]:{display:"flex"}})),$e=S("div")(({theme:s})=>({minWidth:0,display:"flex",flex:"1 1 auto",overflow:"hidden",flexDirection:"column",borderRadius:s.shape.borderRadius*1.5,backgroundColor:s.vars.palette.background.default}));function ze({mail:s,selected:o,sx:n,...r}){return e.jsx(a,{component:"li",sx:{display:"flex"},children:e.jsxs(K,{disableGutters:!0,sx:[{p:1,gap:2,borderRadius:1,...o&&{bgcolor:"action.selected"}},...Array.isArray(n)?n:[n]],...r,children:[e.jsx(q,{alt:s.from.name,src:s.from.avatarUrl??"",children:s.from.name.charAt(0).toUpperCase()}),e.jsx(ne,{primary:s.from.name,secondary:s.message,slotProps:{primary:{noWrap:!0},secondary:{noWrap:!0,sx:{...s.isUnread&&{color:"text.primary",fontWeight:"fontWeightSemiBold"}}}}}),e.jsxs(a,{sx:{display:"flex",alignSelf:"stretch",alignItems:"flex-end",flexDirection:"column"},children:[e.jsx(y,{noWrap:!0,variant:"body2",component:"span",sx:{mb:1.5,fontSize:12,color:"text.disabled"},children:oe(s.createdAt)}),!!s.isUnread&&e.jsx(a,{component:"span",sx:{width:8,height:8,borderRadius:"50%",bgcolor:"info.main"}})]})]})})}function Ne({isEmpty:s,loading:o,mails:n,openMail:r,onCloseMail:t,onClickMail:l,selectedMailId:i,selectedLabelId:p}){const f=U(d=>d.breakpoints.up("md")),g=()=>e.jsx(m,{sx:{px:2,flex:"1 1 auto"},children:e.jsx(Le,{})}),w=()=>e.jsx(m,{sx:{px:2,flex:"1 1 auto"},children:e.jsx(G,{title:`Nothing in ${p}`,description:"This folder is empty",imgUrl:`${D.assetsDir}/assets/icons/empty/ic-folder-empty.svg`})}),v=()=>s?w():e.jsx(V,{sx:{flex:"1 1 0"},children:e.jsx("nav",{children:e.jsx(a,{component:"ul",sx:{px:2,pb:1,gap:.5,display:"flex",flexDirection:"column"},children:n.allIds.map(d=>e.jsx(ze,{mail:n.byId[d],selected:i===d,onClick:()=>l(d)},d))})})}),h=()=>e.jsxs(e.Fragment,{children:[e.jsx(m,{sx:{p:2},children:f?e.jsx(J,{placeholder:"Search...",slotProps:{input:{startAdornment:e.jsx(P,{position:"start",children:e.jsx(c,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}},sx:[s&&{display:"none"}]}):e.jsx(y,{variant:"h6",sx:{textTransform:"capitalize"},children:p})}),o?g():v()]});return e.jsxs(e.Fragment,{children:[h(),e.jsx(Z,{open:r,onClose:t,slotProps:{backdrop:{invisible:!0},paper:{sx:{width:320}}},children:h()})]})}function We({onOpenNav:s,onOpenMail:o,sx:n,...r}){return e.jsxs(a,{sx:[{py:1,mb:1,display:"flex",alignItems:"center"},...Array.isArray(n)?n:[n]],...r,children:[e.jsx(x,{onClick:s,children:e.jsx(c,{icon:"solar:letter-bold"})}),o&&e.jsx(x,{onClick:o,children:e.jsx(c,{icon:"solar:chat-round-dots-bold"})}),e.jsx(J,{fullWidth:!0,size:"small",placeholder:"Search...",slotProps:{input:{startAdornment:e.jsx(P,{position:"start",children:e.jsx(c,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}},sx:{ml:2}})]})}const A=20;function Be({onCloseCompose:s}){const o=U(i=>i.breakpoints.up("sm")),n=k(),[r,t]=u.useState(""),l=u.useCallback(i=>{t(i)},[]);return u.useEffect(()=>(n.value?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[n.value]),e.jsxs(re,{children:[(n.value||!o)&&e.jsx(te,{open:!0,sx:[i=>({zIndex:i.zIndex.modal-1})]}),e.jsxs(ae,{sx:[i=>({maxWidth:560,right:A,borderRadius:2,display:"flex",bottom:A,position:"fixed",overflow:"hidden",flexDirection:"column",zIndex:i.zIndex.modal,width:`calc(100% - ${A*2}px)`,boxShadow:i.vars.customShadows.dropdown,...n.value&&{maxWidth:1,height:`calc(100% - ${A*2}px)`}})],children:[e.jsxs(a,{sx:[i=>({display:"flex",alignItems:"center",bgcolor:"background.neutral",p:i.spacing(1.5,1,1.5,2)})],children:[e.jsx(y,{variant:"h6",sx:{flexGrow:1},children:"New message"}),e.jsx(x,{onClick:n.onToggle,children:e.jsx(c,{icon:n.value?"eva:collapse-fill":"eva:expand-fill"})}),e.jsx(x,{onClick:s,children:e.jsx(c,{icon:"mingcute:close-line"})})]}),e.jsx(_,{id:"mail-compose-to",placeholder:"To",endAdornment:e.jsxs(a,{sx:{gap:.5,display:"flex",typography:"subtitle2"},children:[e.jsx(a,{sx:{cursor:"pointer","&:hover":{textDecoration:"underline"}},children:"Cc"}),e.jsx(a,{sx:{cursor:"pointer","&:hover":{textDecoration:"underline"}},children:"Bcc"})]}),sx:[i=>({px:2,height:48,borderBottom:`solid 1px ${N(i.vars.palette.grey["500Channel"],.08)}`})]}),e.jsx(_,{id:"mail-compose-subject",placeholder:"Subject",sx:[i=>({px:2,height:48,borderBottom:`solid 1px ${N(i.vars.palette.grey["500Channel"],.08)}`})]}),e.jsxs(a,{sx:{p:2,gap:2,display:"flex",flex:"1 1 auto",overflow:"hidden",flexDirection:"column"},children:[e.jsx(Y,{value:r,onChange:l,placeholder:"Type a message",slotProps:{wrapper:{...n.value&&{minHeight:0,flex:"1 1 auto"}}},sx:{maxHeight:480,...n.value&&{maxHeight:1,flex:"1 1 auto"}}}),e.jsxs(a,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(x,{children:e.jsx(c,{icon:"solar:gallery-add-bold"})}),e.jsx(x,{children:e.jsx(c,{icon:"eva:attach-2-fill"})}),e.jsx(a,{sx:{flexGrow:1}}),e.jsx(R,{variant:"contained",color:"primary",endIcon:e.jsx(c,{icon:"custom:send-fill"}),children:"Send"})]})]})]})]})}function Re({mail:s,renderLabel:o,error:n,loading:r}){const t=k(!0),l=k(s==null?void 0:s.isStarred),i=k(s==null?void 0:s.isImportant);if(r)return e.jsx(ie,{});if(n)return e.jsx(G,{title:n,imgUrl:`${D.assetsDir}/assets/icons/empty/ic-email-disabled.svg`});const p=()=>e.jsxs(e.Fragment,{children:[e.jsx(a,{sx:{gap:1,flexGrow:1,display:"flex"},children:s==null?void 0:s.labelIds.map(d=>{const b=o==null?void 0:o(d);return b?e.jsx(le,{sx:[L=>({color:de(b.color,.24),bgcolor:ce(b.color,.16),...L.applyStyles("dark",{color:xe(b.color,.24)})})],children:b.name},b.id):null})}),e.jsxs(a,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(X,{color:"warning",icon:e.jsx(c,{icon:"eva:star-outline"}),checkedIcon:e.jsx(c,{icon:"eva:star-fill"}),checked:l.value,onChange:l.onToggle,slotProps:{input:{id:"starred-checkbox","aria-label":"Starred checkbox"}}}),e.jsx(X,{color:"warning",icon:e.jsx(c,{icon:"ic:round-label-important"}),checkedIcon:e.jsx(c,{icon:"ic:round-label-important"}),checked:i.value,onChange:i.onToggle,slotProps:{input:{id:"important-checkbox","aria-label":"Important checkbox"}}}),e.jsx($,{title:"Archive",children:e.jsx(x,{children:e.jsx(c,{icon:"solar:archive-down-minimlistic-bold"})})}),e.jsx($,{title:"Mark Unread",children:e.jsx(x,{children:e.jsx(c,{icon:"solar:letter-unread-bold"})})}),e.jsx($,{title:"Trash",children:e.jsx(x,{children:e.jsx(c,{icon:"solar:trash-bin-trash-bold"})})}),e.jsx(x,{children:e.jsx(c,{icon:"eva:more-vertical-fill"})})]})]}),f=()=>e.jsxs(e.Fragment,{children:[e.jsxs(y,{variant:"subtitle2",sx:[d=>({...d.mixins.maxLine({line:2}),flex:"1 1 auto"})],children:["Re: ",s==null?void 0:s.subject]}),e.jsxs(m,{spacing:.5,children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",justifyContent:"flex-end"},children:[e.jsx(x,{size:"small",children:e.jsx(c,{width:18,icon:"solar:reply-bold"})}),e.jsx(x,{size:"small",children:e.jsx(c,{width:18,icon:"solar:multiple-forward-left-broken"})}),e.jsx(x,{size:"small",children:e.jsx(c,{width:18,icon:"solar:forward-bold"})})]}),e.jsx(y,{variant:"caption",noWrap:!0,sx:{color:"text.disabled"},children:pe(s==null?void 0:s.createdAt)})]})]}),g=()=>e.jsxs(e.Fragment,{children:[e.jsx(q,{alt:s==null?void 0:s.from.name,src:s!=null&&s.from.avatarUrl?`${s==null?void 0:s.from.avatarUrl}`:"",sx:{mr:2},children:s==null?void 0:s.from.name.charAt(0).toUpperCase()}),e.jsxs(m,{spacing:.5,sx:{width:0,flexGrow:1},children:[e.jsxs(a,{sx:{gap:.5,display:"flex"},children:[e.jsx(y,{component:"span",variant:"subtitle2",sx:{flexShrink:0},children:s==null?void 0:s.from.name}),e.jsx(y,{component:"span",noWrap:!0,variant:"body2",sx:{color:"text.secondary"},children:`<${s==null?void 0:s.from.email}>`})]}),e.jsxs(y,{noWrap:!0,component:"span",variant:"caption",sx:{color:"text.secondary"},children:["To: ",s==null?void 0:s.to.map(d=>e.jsx(he,{color:"inherit",sx:{"&:hover":{color:"text.primary"}},children:`${d.email}, `},d.email))]})]})]}),w=()=>e.jsxs(m,{spacing:1,sx:{p:1,borderRadius:1,bgcolor:"background.neutral"},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(Q,{onClick:t.onToggle,sx:{borderRadius:.5,typography:"caption",color:"text.secondary"},children:[e.jsx(c,{icon:"eva:attach-2-fill",sx:{mr:.5}}),s==null?void 0:s.attachments.length," attachments",e.jsx(c,{icon:t.value?"eva:arrow-ios-upward-fill":"eva:arrow-ios-downward-fill",width:16,sx:{ml:.5}})]}),e.jsxs(Q,{sx:{py:.5,gap:.5,px:.75,borderRadius:.75,typography:"caption",fontWeight:"fontWeightSemiBold"},children:[e.jsx(c,{width:18,icon:"eva:cloud-download-fill"})," Download"]})]}),e.jsx(ue,{in:t.value,unmountOnExit:!0,timeout:"auto",children:e.jsx(a,{sx:{gap:.75,display:"flex",flexWrap:"wrap"},children:s==null?void 0:s.attachments.map(d=>e.jsx(fe,{tooltip:!0,imageView:!0,file:d.preview,onDownload:()=>console.info("DOWNLOAD"),slotProps:{icon:{sx:{width:24,height:24}}},sx:{width:48,height:48,bgcolor:"background.paper"}},d.id))})})]}),v=()=>e.jsx(ye,{children:s==null?void 0:s.message,sx:{px:2,"& p":{typography:"body2"}}}),h=()=>e.jsxs(e.Fragment,{children:[e.jsx(Y,{sx:{maxHeight:320}}),e.jsxs(a,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(x,{children:e.jsx(c,{icon:"solar:gallery-add-bold"})}),e.jsx(x,{children:e.jsx(c,{icon:"eva:attach-2-fill"})}),e.jsx(m,{sx:{flexGrow:1}}),e.jsx(R,{color:"primary",variant:"contained",endIcon:e.jsx(c,{icon:"custom:send-fill"}),children:"Send"})]})]});return s&&e.jsxs(e.Fragment,{children:[e.jsx(a,{sx:{pl:2,pr:1,height:56,flexShrink:0,display:"flex",alignItems:"center"},children:p()}),e.jsx(a,{sx:[d=>({p:2,gap:2,flexShrink:0,display:"flex",borderTop:`1px dashed ${d.vars.palette.divider}`,borderBottom:`1px dashed ${d.vars.palette.divider}`})],children:f()}),e.jsx(a,{sx:{pt:2,px:2,flexShrink:0,display:"flex",alignItems:"center"},children:g()}),!!(s!=null&&s.attachments.length)&&e.jsxs(m,{sx:{px:2,mt:2},children:[" ",w()," "]}),e.jsx(V,{sx:{mt:3,flex:"1 1 240px"},children:v()}),e.jsx(m,{spacing:2,sx:{flexShrink:0,p:2},children:h()})]})}const z="inbox";function Ve(){const s=je(),o=U(j=>j.breakpoints.up("md")),n=me(),r=n.get("label")??z,t=n.get("id")??"",l=k(),i=k(),p=k(),{labels:f,labelsLoading:g,labelsEmpty:w}=ve(),{mail:v,mailLoading:h,mailError:d}=ke(t),{mails:b,mailsLoading:L,mailsEmpty:M}=we(r),E=b.allIds[0]||"",ee=u.useCallback(()=>{l.value&&l.onFalse(),p.onToggle()},[p,l]),se=u.useCallback(j=>{o||l.onFalse();const C=j!==z?`${T.dashboard.mail}?label=${j}`:T.dashboard.mail;r!==j&&u.startTransition(()=>{s.push(C)})},[o,r,l,s]),F=u.useCallback(j=>{o||i.onFalse();const C=r!==z?`${T.dashboard.mail}?id=${j}&label=${r}`:`${T.dashboard.mail}?id=${j}`;t!==j&&u.startTransition(()=>{s.push(C)})},[o,i,s,r,t]);return u.useEffect(()=>{!t&&E&&F(E)},[E,F,t]),e.jsxs(e.Fragment,{children:[e.jsxs(ge,{maxWidth:!1,sx:{flex:"1 1 auto",display:"flex",flexDirection:"column"},children:[e.jsx(y,{variant:"h4",sx:{mb:{xs:3,md:5}},children:"Mail"}),e.jsx(Te,{sx:{p:1,borderRadius:2,flex:"1 1 auto",bgcolor:"background.neutral"},slots:{header:e.jsx(We,{onOpenNav:l.onTrue,onOpenMail:M?void 0:i.onTrue,sx:{display:{md:"none"}}}),nav:e.jsx(Me,{labels:f,isEmpty:w,loading:g,openNav:l.value,onCloseNav:l.onFalse,selectedLabelId:r,onClickLabel:se,onToggleCompose:ee}),list:e.jsx(Ne,{mails:b,isEmpty:M,loading:L,openMail:i.value,onCloseMail:i.onFalse,onClickMail:F,selectedLabelId:r,selectedMailId:t}),details:e.jsx(Re,{mail:v,error:d==null?void 0:d.message,loading:L||h,renderLabel:j=>f.find(C=>C.id===j)})},slotProps:{list:{sx:[M&&{display:"flex",flex:"1 1 auto"}]},details:{sx:[M&&{display:"none"}]}}})]}),p.value&&e.jsx(Be,{onCloseCompose:p.onFalse})]})}const Ue={title:`Mail | Dashboard - ${D.appName}`};function es(){return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:Ue.title}),e.jsx(Ve,{})]})}export{es as default};
